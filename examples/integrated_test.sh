#!/bin/bash -ue
#****h* example/integrated_test
# NAME
#  integrated_test.sh
# DESCRIPTION
#  Run an integrated test
#
# USAGE
#  ./integrated_test.sh
#
#******

cd "$(dirname "$0")" || exit

#### Example using timed automata

## Run small
diff <(../build/monaa -f small.dot < small.txt) - <<EOF
  0.300000       <= t <   0.500000
  0.700000        < t' <   1.500000
  0.200000        < t' - t <   1.000000
=============================
EOF

#### Example using TREs

diff <(../build/monaa -e '(AB)$'  < ./getting_started/timed_word.txt) - <<EOF
 -0.000000       <= t <   0.500000
  0.800000        < t' <=   1.500000
  0.300000        < t' - t <=   1.500000
=============================
  1.500000       <= t <   2.000000
  3.200000        < t' <=   3.500000
  1.200000        < t' - t <=   2.000000
=============================
EOF

diff <(../build/monaa '(AB)$' < ./getting_started/timed_word.txt) - <<EOF
 -0.000000       <= t <   0.500000
  0.800000        < t' <=   1.500000
  0.300000        < t' - t <=   1.500000
=============================
  1.500000       <= t <   2.000000
  3.200000        < t' <=   3.500000
  1.200000        < t' - t <=   2.000000
=============================
EOF

diff <(../build/monaa -e '(A(B)%(1,20))$' < ../examples/getting_started/timed_word.txt) - <<EOF
  1.500000       <= t <   2.000000
  3.200000        < t' <=   3.500000
  1.200000        < t' - t <=   2.000000
=============================
EOF

diff <(../build/monaa '(A(B)%(1,20))$' < ../examples/getting_started/timed_word.txt) - <<EOF
  1.500000       <= t <   2.000000
  3.200000        < t' <=   3.500000
  1.200000        < t' - t <=   2.000000
=============================
EOF

diff <(../build/monaa -e '(A(B|C)%(1,20))$' < ../examples/getting_started/timed_word.txt) - <<EOF
  1.500000       <= t <   2.000000
  3.200000        < t' <=   3.500000
  1.200000        < t' - t <=   2.000000
=============================
  3.200000       <= t <   3.500000
  4.600000        < t' <=        inf
  1.100000        < t' - t <=        inf
=============================
EOF

diff <(../build/monaa '(A(B|C)%(1,20))$' < ../examples/getting_started/timed_word.txt) - <<EOF
  1.500000       <= t <   2.000000
  3.200000        < t' <=   3.500000
  1.200000        < t' - t <=   2.000000
=============================
  3.200000       <= t <   3.500000
  4.600000        < t' <=        inf
  1.100000        < t' - t <=        inf
=============================
EOF

diff <(../build/monaa -e '((A(B|C))+%(1,20))$' < ../examples/getting_started/timed_word.txt) - <<EOF
  1.500000       <= t <   2.000000
  3.200000        < t' <=   3.500000
  1.200000        < t' - t <=   2.000000
=============================
  1.500000       <= t <   2.000000
  4.600000        < t' <=        inf
  2.600000        < t' - t <=        inf
=============================
  3.200000       <= t <   3.500000
  4.600000        < t' <=        inf
  1.100000        < t' - t <=        inf
=============================
EOF

diff <(../build/monaa '((A(B|C))+%(1,20))$' < ../examples/getting_started/timed_word.txt) - <<EOF
  1.500000       <= t <   2.000000
  3.200000        < t' <=   3.500000
  1.200000        < t' - t <=   2.000000
=============================
  1.500000       <= t <   2.000000
  4.600000        < t' <=        inf
  2.600000        < t' - t <=        inf
=============================
  3.200000       <= t <   3.500000
  4.600000        < t' <=        inf
  1.100000        < t' - t <=        inf
=============================
EOF

# diff <(../build/monaa -e '((A(B|C))*%(1,20))$' < ../examples/getting_started/timed_word.txt) - <<EOF
#   1.500000       <= t <   2.000000
#   3.200000        < t' <=   3.500000
#   1.200000        < t' - t <=   2.000000
# =============================
#   1.500000       <= t <   2.000000
#   4.600000        < t' <=        inf
#   2.600000        < t' - t <=        inf
# =============================
#   3.200000       <= t <   3.500000
#   4.600000        < t' <=        inf
#   1.100000        < t' - t <=        inf
# =============================
# EOF

# diff <(../build/monaa '((A(B|C))*%(1,20))$' < ../examples/getting_started/timed_word.txt) - <<EOF
#   1.500000       <= t <   2.000000
#   3.200000        < t' <=   3.500000
#   1.200000        < t' - t <=   2.000000
# =============================
#   1.500000       <= t <   2.000000
#   4.600000        < t' <=        inf
#   2.600000        < t' - t <=        inf
# =============================
#   3.200000       <= t <   3.500000
#   4.600000        < t' <=        inf
#   1.100000        < t' - t <=        inf
# =============================
# EOF
